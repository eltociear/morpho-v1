diff -ruN compound/MorphoGovernance.sol compound/MorphoGovernance.sol
--- compound/MorphoGovernance.sol	2023-01-17 11:30:39.575614966 +0100
+++ compound/MorphoGovernance.sol	2023-01-17 11:45:43.962869912 +0100
@@ -147,7 +147,7 @@
         uint256 _maxSortedUsers,
         address _cEth,
         address _wEth
-    ) external initializer {
+    ) public initializer { // HARNESS
         __ReentrancyGuard_init();
         __Ownable_init();
 
diff -ruN compound/MorphoUtils.sol compound/MorphoUtils.sol
--- compound/MorphoUtils.sol	2023-01-17 11:30:39.575614966 +0100
+++ compound/MorphoUtils.sol	2023-01-17 11:45:43.962869912 +0100
@@ -4,7 +4,7 @@
 import "@rari-capital/solmate/src/utils/SafeTransferLib.sol";
 import "@openzeppelin/contracts/utils/math/Math.sol";
 import "./libraries/CompoundMath.sol";
-import "@morpho-dao/morpho-utils/DelegateCall.sol";
+import "../../helpers/DelegateCallHarness.sol";
 
 import "./MorphoStorage.sol";
 
diff -ruN compound/PositionsManager.sol compound/PositionsManager.sol
--- compound/PositionsManager.sol	2023-01-17 11:30:39.575614966 +0100
+++ compound/PositionsManager.sol	2023-01-17 12:04:57.228634549 +0100
@@ -236,7 +236,8 @@
         address _onBehalf,
         uint256 _amount,
         uint256 _maxGasForMatching
-    ) external {
+    ) external override {
+        //HARNESS : get a compiler error without this
         if (_onBehalf == address(0)) revert AddressIsZero();
         if (_amount == 0) revert AmountIsZero();
         if (!marketStatus[_poolToken].isCreated) revert MarketNotCreated();
@@ -333,7 +334,8 @@
         address _poolToken,
         uint256 _amount,
         uint256 _maxGasForMatching
-    ) external {
+    ) external override {
+        // HARNESS
         if (_amount == 0) revert AmountIsZero();
         if (!marketStatus[_poolToken].isCreated) revert MarketNotCreated();
         if (marketPauseStatus[_poolToken].isBorrowPaused) revert BorrowIsPaused();
@@ -436,7 +438,8 @@
         address _supplier,
         address _receiver,
         uint256 _maxGasForMatching
-    ) external {
+    ) external override {
+        // HARNESS
         if (_amount == 0) revert AmountIsZero();
         if (_receiver == address(0)) revert AddressIsZero();
         if (!marketStatus[_poolToken].isCreated) revert MarketNotCreated();
@@ -448,7 +451,7 @@
 
         if (_isLiquidatable(_supplier, _poolToken, toWithdraw, 0)) revert UnauthorisedWithdraw();
 
-        _unsafeWithdrawLogic(_poolToken, toWithdraw, _supplier, _receiver, _maxGasForMatching);
+        _unsafeWithdrawLogic( _poolToken, toWithdraw, _supplier, _receiver, _maxGasForMatching, true); // prettier-ignore
     }
 
     /// @dev Implements repay logic with security checks.
@@ -463,7 +466,8 @@
         address _onBehalf,
         uint256 _amount,
         uint256 _maxGasForMatching
-    ) external {
+    ) external override {
+        // HARNESS
         if (_amount == 0) revert AmountIsZero();
         if (!marketStatus[_poolToken].isCreated) revert MarketNotCreated();
         if (marketPauseStatus[_poolToken].isRepayPaused) revert RepayIsPaused();
@@ -472,7 +476,7 @@
         _updateP2PIndexes(_poolToken);
         uint256 toRepay = Math.min(_getUserBorrowBalanceInOf(_poolToken, _onBehalf), _amount);
 
-        _unsafeRepayLogic(_poolToken, _repayer, _onBehalf, toRepay, _maxGasForMatching);
+        _unsafeRepayLogic(_poolToken, _repayer, _onBehalf, toRepay, _maxGasForMatching, true);
     }
 
     /// @notice Liquidates a position.
@@ -485,7 +489,7 @@
         address _poolTokenCollateral,
         address _borrower,
         uint256 _amount
-    ) external {
+    ) external virtual override {
         if (!marketStatus[_poolTokenCollateral].isCreated) revert MarketNotCreated();
         if (marketPauseStatus[_poolTokenCollateral].isLiquidateCollateralPaused)
             revert LiquidateCollateralIsPaused();
@@ -512,7 +516,7 @@
         if (_amount > vars.borrowBalance.mul(vars.closeFactor))
             revert AmountAboveWhatAllowedToRepay(); // Same mechanism as Compound. Liquidator cannot repay more than part of the debt (cf close factor on Compound).
 
-        _unsafeRepayLogic(_poolTokenBorrowed, msg.sender, _borrower, _amount, 0);
+        _unsafeRepayLogic(_poolTokenBorrowed, msg.sender, _borrower, _amount, 0, false);
 
         ICompoundOracle compoundOracle = ICompoundOracle(comptroller.oracle());
         vars.collateralPrice = compoundOracle.getUnderlyingPrice(_poolTokenCollateral);
@@ -527,7 +531,7 @@
             _getUserSupplyBalanceInOf(_poolTokenCollateral, _borrower)
         );
 
-        _unsafeWithdrawLogic(_poolTokenCollateral, vars.amountToSeize, _borrower, msg.sender, 0);
+        _unsafeWithdrawLogic( _poolTokenCollateral, vars.amountToSeize, _borrower, msg.sender, 0, false); // prettier-ignore
 
         emit Liquidated(
             msg.sender,
@@ -591,7 +595,8 @@
         uint256 _amount,
         address _supplier,
         address _receiver,
-        uint256 _maxGasForMatching
+        uint256 _maxGasForMatching,
+        bool matchingEnabled
     ) internal {
         WithdrawVars memory vars;
         vars.underlyingToken = _getUnderlying(_poolToken);
@@ -654,7 +659,8 @@
         _updateSupplierInDS(_poolToken, _supplier);
 
         // Reduce the peer-to-peer supply delta.
-        if (vars.remainingToWithdraw > 0 && delta.p2pSupplyDelta > 0) {
+        if (vars.remainingToWithdraw > 0 && delta.p2pSupplyDelta > 0 && delta.p2pBorrowDelta == 0) {
+            // HARNESS: should be equivalent since there can be only one positive delta
             uint256 deltaInUnderlying = delta.p2pSupplyDelta.mul(vars.poolSupplyIndex);
 
             if (deltaInUnderlying > vars.remainingToWithdraw) {
@@ -677,6 +683,7 @@
 
         // Promote pool suppliers.
         if (
+            matchingEnabled && // HARNESS: remove promote suppliers in liquidate
             vars.remainingToWithdraw > 0 &&
             !p2pDisabled[_poolToken] &&
             suppliersOnPool[_poolToken].getHead() != address(0)
@@ -704,11 +711,14 @@
 
         // Demote peer-to-peer borrowers.
         if (vars.remainingToWithdraw > 0) {
-            uint256 unmatched = _unmatchBorrowers(
-                _poolToken,
-                vars.remainingToWithdraw,
-                vars.remainingGasForMatching
-            );
+            uint256 unmatched = 0;
+            // HARNESS: remove demote borrowers in liquidate
+            if (matchingEnabled)
+                unmatched = _unmatchBorrowers(
+                    _poolToken,
+                    vars.remainingToWithdraw,
+                    vars.remainingGasForMatching
+                );
 
             // Increase the peer-to-peer borrow delta.
             if (unmatched < vars.remainingToWithdraw) {
@@ -749,7 +759,8 @@
         address _repayer,
         address _onBehalf,
         uint256 _amount,
-        uint256 _maxGasForMatching
+        uint256 _maxGasForMatching,
+        bool matchingEnabled
     ) internal {
         if (lastBorrowBlock[_onBehalf] == block.number) revert SameBlockBorrowRepay();
 
@@ -854,6 +865,7 @@
 
         // Promote pool borrowers.
         if (
+            matchingEnabled && // HARNESS: remove promote borrowers in liquidate
             vars.remainingToRepay > 0 &&
             !p2pDisabled[_poolToken] &&
             borrowersOnPool[_poolToken].getHead() != address(0)
@@ -879,11 +891,14 @@
 
         // Unmote peer-to-peer suppliers.
         if (vars.remainingToRepay > 0) {
-            uint256 unmatched = _unmatchSuppliers(
-                _poolToken,
-                vars.remainingToRepay,
-                vars.remainingGasForMatching
-            );
+            uint256 unmatched = 0;
+            if (matchingEnabled)
+                // HARNESS: remove demote suppliers in liquidate
+                unmatched = _unmatchSuppliers(
+                    _poolToken,
+                    vars.remainingToRepay,
+                    vars.remainingGasForMatching
+                );
 
             // Increase the peer-to-peer supply delta.
             if (unmatched < vars.remainingToRepay) {
diff -ruN .gitignore .gitignore
--- .gitignore	1970-01-01 01:00:00.000000000 +0100
+++ .gitignore	2023-01-17 11:45:43.962869912 +0100
@@ -0,0 +1,2 @@
+*
+!.gitignore
